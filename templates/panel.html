<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel de Administrador</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        #buscador {
            margin-bottom: 20px;
        }
    </style>
</head>
<body class="bg-dark text-white">
    <div class="container mt-5">
        <h1 class="text-center mb-4">ðŸ“‹ Registros Realizados</h1>

        <input type="text" id="buscador" class="form-control" placeholder="Buscar en los registros...">

        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}
        {% endwith %}

        <table class="table table-bordered table-dark table-hover align-middle text-center" id="tabla-registros">
            <thead class="table-light">
                <tr>
                    <th>Folio</th>
                    <th>Marca</th>
                    <th>LÃ­nea</th>
                    <th>AÃ±o</th>
                    <th>Serie</th>
                    <th>Motor</th>
                    <th>ExpediciÃ³n</th>
                    <th>Vencimiento</th>
                    <th>PDF</th>
                </tr>
            </thead>
            <tbody>
                {% for r in registros|sort(attribute='fecha_expedicion', reverse=True) %}
                <tr>
                    <td>{{ r.folio }}</td>
                    <td>{{ r.marca }}</td>
                    <td>{{ r.linea }}</td>
                    <td>{{ r.anio }}</td>
                    <td>{{ r.numero_serie }}</td>
                    <td>{{ r.numero_motor }}</td>
                    <td>{{ r.fecha_expedicion[:10] }}</td>
                    <td>{{ r.fecha_vencimiento[:10] }}</td>
                    <td>
                        <a href="{{ url_for('descargar_pdf', folio=r.folio) }}" class="btn btn-sm btn-primary" target="_blank">
                            Descargar
                        </a>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="9">No hay registros aÃºn.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const buscador = document.getElementById("buscador");
        const tabla = document.getElementById("tabla-registros").getElementsByTagName("tbody")[0];

        buscador.addEventListener("input", function () {
            const filtro = buscador.value.toLowerCase();
            const filas = tabla.getElementsByTagName("tr");

            for (let i = 0; i < filas.length; i++) {
                const fila = filas[i];
                const texto = fila.textContent.toLowerCase();
                fila.style.display = texto.includes(filtro) ? "" : "none";
            }
        });
    </script>
</body>
</html>
